<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 FIFAワールドカップ 本戦抽選会（模擬）│サッカー日本代表応援</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<style>
    a {color: #fff;}
    /* 日本決まった瞬間用フラッシュ */
    body.japan-mode {
      background: radial-gradient(circle, #fff 10%, #bc002d 40%, #fff 70%);
      animation: japanFlash 2s ease-out;
    }
    @keyframes japanFlash {
      0% {background: radial-gradient(circle, #fff 0%, #bc002d 0%, #fff 0%);}
      50% {background: radial-gradient(circle, #fff 60%, #bc002d 90%);}
      100% {background: linear-gradient(135deg, #0f2b5e, #1a4d8c);}
    }
        body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #0f2b5e, #1a4d8c);
      color: white;
      text-align: center;
      padding: 15px 6px;
      min-height: 100vh;
      margin: 0;
      transition: background 1.5s;
    }
	  
    h1 {
      font-size: 1.8rem;
      margin: 20px 0 15px;
      text-shadow: 0 0 20px #ffcb05;
    }
	  
    button#startBtn {
      background: #ffcb05;
      color: #0f2b5e;
      font-size: 1.6rem;
      font-weight: bold;
      padding: 16px 60px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      margin: 30px auto;
      display: block;
    }
    button#startBtn2 {
      background: #ffcb05;
      color: #0f2b5e;
      font-size: 1.6rem;
      font-weight: bold;
      padding: 16px 60px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      margin: 30px auto;
      display: block;
    }
    button:hover:not(:disabled) {transform: translateY(-8px) scale(1.05);}
    button:disabled {background: #555;opacity: 0.7;}
	  
    /* ポット分け表（最初に表示） */
    /* スマホ対応：ポット表を縦に並べる */
    /* ポット表：PC・タブレットは横4列、スマホは縦1列 */
    #potTable {
      max-width: 1500px;
      margin: 20px auto;
      padding: 0 8px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);  /* デフォルト：横4列 */
      gap: 12px;
    }

    @media (min-width: 400px) and (max-width: 799px) {
      #potTable { grid-template-columns: 1fr 1fr; }
    }

    @media (max-width: 399px) {
      #potTable { grid-template-columns: 1fr; gap: 15px; }
    }

    .pot {
      background: rgba(255,255,255,0.13);
      border-radius: 16px;
      padding: 12px 10px;
      border: 1px solid rgba(255,203,5,0.35);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
	  
    .pot h2 {
      font-size: 1.5rem;
      color: #ffcb05;
      margin: 0 0 8px;
      text-shadow: 0 0 12px gold;
      border-bottom: 1.5px solid #ffcb05;
      padding-bottom: 6px;
    }
	  
    .pot-team {
      background: rgba(255,255,255,0.18);
      margin: 3px 0;
      padding: 5px 8px;
      border-radius: 10px;
      font-size: 1rem;              /* 超小さく */
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;                     /* 極小間隔 */
      line-height: 1.1;
      white-space: nowrap;
      overflow: hidden;
      transition: background 0.2s;
    }
	  
    .pot-team:hover {
      background: rgba(255,203,5,0.22);
    }
	  
   .pot-team img {
      width: 32px;                  /* 超ミニ旗 */
      height: 21px;
      border-radius: 4px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.4);
      flex-shrink: 0;
    }

    .pot-team span {
      overflow: hidden;
      text-overflow: ellipsis;
    }
	  
/* 日本は小さくても目立つ！ */
   .pot-team.japan {
      background: linear-gradient(135deg, #bc002d, #fff);
      color: #bc002d;
      font-weight: bold;
      font-size: 1.18rem !important;
      padding: 6px 8px;
      border: 1px solid #fff;
      box-shadow: 0 0 15px rgba(188,0,45,0.8);
    }
	  
    .pot-team.japan img {
      width: 38px;
      height: 25px;
      border: 1.5px solid #fff;
    }


	  
    #status {margin: 50px auto;min-height: 180px;display: flex;flex-direction: column;align-items: center;justify-content: center;gap: 30px;}
    #loadingContainer {opacity: 0;transition: opacity 0.7s;}
    #loadingContainer.show {opacity: 1;}
    #loadingImg {width: 120px;height: 120px;filter: drop-shadow(0 0 25px #ffcb05);}

    .loading-text {font-size: 2.8rem;font-weight: bold;color: #ffcb05;text-shadow: 0 0 25px rgba(255,203,5,1);letter-spacing: 5px;}
    .loading-dots span {opacity: 0;animation: dotPulse 1.8s infinite;}
    .loading-dots span:nth-child(1) {animation-delay: 0s;}
    .loading-dots span:nth-child(2) {animation-delay: 0.5s;}
    .loading-dots span:nth-child(3) {animation-delay: 1s;}
    @keyframes dotPulse {0%,100%{opacity:0} 50%{opacity:1}}

    #bTitle {
      font-size: 0.65rem;
      color: white;
      text-align: center;
    }
    /* 日本専用・超ド派手演出 */
    #japanLog {
      width: 100vw;
      background: linear-gradient(135deg, #0f2b5e, #1a4d8c);
      font-size: 0.65rem;
      color: white;
      text-align: center;
      position: fixed; 
      top: 0px;
      right: 0px;
      left: 0px;
      margin: 0;
      z-index: 9999;
    }
    #japanSpecial {
      position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%) scale(0);
      font-size: 2rem;font-weight: 900;color: #bc002d;text-shadow: 0 0 80px #fff, 0 0 120px #bc002d;
      z-index: 9999;pointer-events: none;opacity: 0;
      animation: japanBoom 3s ease-out forwards;
      letter-spacing: 10px;
    }
    @keyframes japanBoom {
      0%   {transform: translate(-50%, -50%) scale(0); opacity: 0;}
      40%  {transform: translate(-50%, -50%) scale(1.3); opacity: 1;}
      70%  {transform: translate(-50%, -50%) scale(1); opacity: 1;}
      100% {transform: translate(-50%, -50%) scale(0.9); opacity: 0;}
    }
    
    /* 最新1件をド派手に表示 */
    #latestDraw {margin: 60px auto;padding: 30px;min-height: 200px;perspective: 1500px;}
    #currentDraw {
      background: linear-gradient(135deg, rgba(255,203,5,0.4), rgba(255,203,5,0.15));
      border: 4px solid #ffcb05;
      border-radius: 30px;
      padding: 35px 60px;
      max-width: 900px;
      margin: 0 auto;
      font-size: 1rem;
      font-weight: bold;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      opacity: 0;
      transform: scale(0.8) translateY(100px) rotateX(-45deg);
      transition: all 1s cubic-bezier(0.22, 1, 0.36, 1);
      backdrop-filter: blur(15px);
      text-shadow: 0 0 30px gold;
    }
    #currentDraw.show {opacity: 1;transform: scale(1) translateY(0) rotateX(0);}
    #currentDraw img {width: 100px;height: 66px;margin-right: 35px;border-radius: 14px;box-shadow: 0 8px 30px rgba(0,0,0,0.6);vertical-align: middle;}
    #currentDraw .group-letter {color: #ffff00;font-size: 1rem;text-shadow: 0 0 50px gold;margin: 0 30px;font-weight: 900;}

    #result {max-width: 1600px;margin: 60px auto;display: grid;grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));gap: 35px;}
    .group {background: rgba(255,255,255,0.15);border-radius: 28px;padding: 35px;backdrop-filter: blur(15px);border: 1px solid rgba(255,255,255,0.3);}
    .group h2 {margin: 0 0 30px;font-size: 3.2rem;color: #ffcb05;}
    .team {background: rgba(255,255,255,0.3);margin: 16px 0;padding: 20px;border-radius: 16px;font-size: 0.65rem;opacity: 0;transform: translateY(40px);transition: all 0.8s;text-align:left;}
    .team.show {opacity: 1;transform: translateY(0);}
    .team.host {background: rgba(255,203,5,0.7);font-weight: bold;color: #fff;text-align:left;
				}
    .pot-label {padding: 10px 20px;border-radius: 35px;background: #ffcb05;color: #0f2b5e;font-weight: bold;margin-left: 15px;font-size: 0.45rem; position: absolute;right: 0;}

    @keyframes fireworks-animation {
	  0% {
		  transform: translate(-50%, 90vh);
		  width: 4px;
		  opacity: 1;
   	}
	  50% {
	  	width: 4px;
		  opacity: 1;
	  }
	  100% {
		width: 400px;
		opacity: 0;
  	}
  }

  .c-firework,
  .c-firework::before,
  .c-firework::after {
  	content: "";
	  position: absolute;
  	top: 50%;
  	left: 50%;
  	aspect-ratio: 1;
  	background: radial-gradient(circle, #ff0 10px, #000 0) 50% 00%,
		radial-gradient(circle, #ff0 10px, #000 0) 00% 50%,
		radial-gradient(circle, #ff0 10px, #000 0) 50% 99%,
		radial-gradient(circle, #ff0 10px, #000 0) 99% 50%,
		radial-gradient(circle, #ff0 10px, #000 0) 80% 90%,
		radial-gradient(circle, #ff0 10px, #000 0) 95% 90%,
		radial-gradient(circle, #ff0 10px, #000 0) 10% 60%,
		radial-gradient(circle, #ff0 10px, #000 0) 31% 80%,
		radial-gradient(circle, #ff0 10px, #000 0) 80% 10%,
		radial-gradient(circle, #ff0 10px, #000 0) 90% 23%,
		radial-gradient(circle, #ff0 10px, #000 0) 45% 20%,
		radial-gradient(circle, #ff0 10px, #000 0) 13% 24%;
  	background-size: 4px 4px;
	  background-repeat: no-repeat;
  	transform: translate(-50%, -50%);
  	animation: fireworks-animation 4s infinite;
  }
  .c-firework::before {
  	transform: translate(-50%, -50%) rotate(25deg) !important;
  }
  .c-firework::after {
  	transform: translate(-50%, -50%) rotate(-37deg) !important;
  }
	  
/* 抽選中・結果表示もスマホ最適化 */
    #status, #latestDraw, #result {max-width: 900px;margin: 30px auto;padding: 0 8px;}
    #result {gap: 15px;}
    .group {padding: 18px;border-radius: 18px;}
    .group h2 {font-size: 2.1rem;margin-bottom: 15px;}
    .team {padding: 10px;font-size: 1.1rem;margin: 5px 0;}
/* ルール説明 */
	.rule {
	margin: 16px auto;
	text-align: center;
	display: block;
	border: 1px solid #ffcb05;
    }
    .rule ul {
	padding-left: 0;
	list-style: none;
	display: inline-block;
	color: #ffcb05;
	font-size: 0.6rem;
    }
    .rule li {
	color: white;
	font-size: 0.5rem;
    }
    .rule ul li {
	text-align: left;
    }
	  
/* === 抽選終了後のシェアボタンエリア === */
    #shareButtons {
      margin: 40px auto;
      padding: 20px;
      max-width: 800px;
      display: none;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    #shareButtons.show {display: flex !important;}

    .share-btn {
      background: #ffcb05;
      color: #0f2b5e;
      font-size: 1.5rem;
      font-weight: bold;
      padding: 16px 40px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      transition: all 0.4s;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .share-btn:hover {
      transform: translateY(-8px) scale(1.08);
      box-shadow: 0 20px 50px rgba(255,203,5,0.5);
    }
    .share-btn.screenshot {background: #1da1f2;} /* Twitterブルー */
    .share-btn.xshare {background: #000000;}

/* スクショ＆シェアボタンを右下・左下に常時固定！ */
  #fixedButtons {
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: 20px;
    z-index: 9998;
    display: none;
    justify-content: space-between;
    pointer-events: none; /* 背景タップは無効にしない */
    gap: 20px;
  }
  #fixedButtons.show {
    display: flex;
  }

  .fixed-btn {
    background: #ffcb05;
    color: #0f2b5e;
    font-size: 1.4rem;
    font-weight: bold;
    padding: 16px 28px;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 12px 40px rgba(0,0,0,0.7);
    transition: all 0.4s;
    display: flex;
    align-items: center;
    gap: 12px;
    pointer-events: auto; /* ボタンだけはタップ可能 */
    backdrop-filter: blur(10px);
    min-width: 140px;
    justify-content: center;
  }
  .fixed-btn:hover {
    transform: translateY(-10px) scale(1.1);
    box-shadow: 0 20px 60px rgba(255,203,5,0.6);
  }
  .fixed-btn.screenshot {
    background: #1da1f2; /* Twitterブルー */
    color: white;
  }
  .fixed-btn.xshare {
    background: #000000;
    color: white;
  }

  /* スマホでも見やすい調整 */
  @media (max-width: 480px) {
    #fixedButtons { bottom: 15px; left: 15px; right: 15px; }
    .fixed-btn { font-size: 1.2rem; padding: 14px 20px; }
  }
  </style>
</head>
<body>
  <div id="pTitle">
   <h1>2026 FIFA ワールドカップ</h1>
   <p style="font-size:0.8rem;">本戦グループステージ抽選会<br>（シミュレーション）</p>
   <span class="rule">
	<ul> 抽選ルール
		<li> 開催国はグループA:メキシコ / B:カナダ / D:アメリカの1番目に固定 </li>
		<li> ポット1から順に配置し、同一グループに 同じポットのチームが2つ以上入らない </li>
		<li> 欧州（UEFA）は最大2チームまで、それ以外の大陸は最大1チームまで </li>

	</ul>
   </span>
  </div>
  <button id="startBtn">抽選開始</button>
  <!-- ここに最初にポット分け表を表示 -->
  <div id="potTable"></div>
  <!-- 最新1件だけド派手に表示 -->
  <div id="latestDraw">
    <div id="currentDraw"></div>
  </div>
  <!-- 日本専用演出用（最初は非表示） -->
  <div id="japanLog">欧州プレイオフ&大陸間プレイオフは決まり次第更新します。</div>
  <div id="japanSpecial">
	がんばれ！<br>
    ニッポン！
    <div class="c-firework"></div>
    <div class="c-firework"></div>
    <div class="c-firework"></div>
    <div class="c-firework"></div>
    <div class="c-firework"></div>
    <div class="c-firework"></div>
    <div class="c-firework"></div>
    <div class="c-firework"></div>
  </div>
  <div id="status">
    <div id="statusText"><button id="startBtn2">抽選開始</button></div>
    <div id="loadingContainer">
      <img id="loadingImg" src="./IMG_0261.gif" alt="抽選中">
      <div class="loading-text">
        抽選中
        <div class="loading-dots" style="display:inline-block">
          <span>.</span><span>.</span><span>.</span>
        </div>
      </div>
    </div>
  </div>

  <div id="result">
  </div>

<!-- 抽選終了後に表示されるシェアボタン！ -->
  <div id="shareButtons">
    <button class="share-btn screenshot">
      スクショ
    </button>
    <button class="share-btn xshare">
      シェア
    </button>
  </div>
	
  <script>
    document.getElementById("japanSpecial").style.display = "none";
    // 48チーム（2026年大会想定・最新ランキング準拠）
    const teams = [
      // ポット1（開催国＋上位）
      { name: "メキシコ", conf: "CONCACAF", pot: 1, fixed: "A" },
      { name: "カナダ", conf: "CONCACAF", pot: 1, fixed: "B" },
      { name: "アメリカ", conf: "CONCACAF", pot: 1, fixed: "D" },
      { name: "スペイン", conf: "UEFA", pot: 1 },
      { name: "アルゼンチン", conf: "CONMEBOL", pot: 1 },
      { name: "フランス", conf: "UEFA", pot: 1 },
      { name: "イングランド", conf: "UEFA", pot: 1 },
      { name: "ブラジル", conf: "CONMEBOL", pot: 1 },
      { name: "ポルトガル", conf: "UEFA", pot: 1 },
      { name: "オランダ", conf: "UEFA", pot: 1 },
      { name: "ベルギー", conf: "UEFA", pot: 1 },
      { name: "ドイツ", conf: "UEFA", pot: 1 },

      // ポット2
      { name: "日本", conf: "AFC", pot: 2 },
      { name: "韓国", conf: "AFC", pot: 2 },
      { name: "オーストラリア", conf: "AFC", pot: 2 },
      { name: "イラン", conf: "AFC", pot: 2 },
      { name: "ウルグアイ", conf: "CONMEBOL", pot: 2 },
      { name: "コロンビア", conf: "CONMEBOL", pot: 2 },
      { name: "クロアチア", conf: "UEFA", pot: 2 },
      { name: "オーストリア", conf: "UEFA", pot: 2 },
      { name: "スイス", conf: "UEFA", pot: 2 },
      { name: "モロッコ", conf: "CAF", pot: 2 },
      { name: "セネガル", conf: "CAF", pot: 2 },
      { name: "エクアドル", conf: "CONMEBOL", pot: 2 }, // 例：コスタリカなど

      // ポット3
      { name: "ノルウェー", conf: "UEFA", pot: 3 },
      { name: "パナマ", conf: "CONCACAF", pot: 3 },
      { name: "エジプト", conf: "CAF", pot: 3 },
      { name: "アルジェリア", conf: "CAF", pot: 3 },
      { name: "スコットランド", conf: "UEFA", pot: 3 },
      { name: "パラグアイ", conf: "CONMEBOL", pot: 3 },
      { name: "チュニジア", conf: "CAF", pot: 3 },
      { name: "コートジボワール", conf: "CAF", pot: 3 },
      { name: "ウズベキスタン", conf: "AFC", pot: 3 },
      { name: "カタール", conf: "AFC", pot: 3 },
      { name: "サウジアラビア", conf: "AFC", pot: 3 },
      { name: "南アフリカ", conf: "CAF", pot: 3 },

      // ポット4（残り）
      { name: "ヨルダン", conf: "AFC", pot: 4 },
      { name: "カボベルデ", conf: "CAF", pot: 4 },
      { name: "ガーナ", conf: "CAF", pot: 4 },
      { name: "キュラソー", conf: "CONCACAF", pot: 4 },
      { name: "ニュージーランド", conf: "OFC", pot: 4 },
      { name: "ハイチ", conf: "CONCACAF", pot: 4 },
      { name: "欧州PO1", conf: "UEFA", pot: 4 },
      { name: "欧州PO2", conf: "UEFA", pot: 4 },
      { name: "欧州PO3", conf: "UEFA", pot: 4 },
      { name: "欧州PO4", conf: "UEFA", pot: 4 },
      { name: "大陸間PO1", conf: "PO", pot: 4 },
      { name: "大陸間PO2", conf: "PO", pot: 4 },
    ];

    const GROUPS = "ABCDEFGHIJKL".split("");

    // 国旗マップ
    const flagMap = {"アメリカ":"us","メキシコ":"mx","カナダ":"ca","ブラジル":"br","アルゼンチン":"ar","フランス":"fr","イングランド":"gb-eng","スペイン":"es","ドイツ":"de","ベルギー":"be","ポルトガル":"pt","オランダ":"nl","日本":"jp","韓国":"kr","イラン":"ir","オーストラリア":"au","ウルグアイ":"uy","コロンビア":"co","クロアチア":"hr","デンマーク":"dk","スイス":"ch","モロッコ":"ma","セネガル":"sn","コスタリカ":"cr","サウジアラビア":"sa","エジプト":"eg","ナイジェリア":"ng","チュニジア":"tn","セルビア":"rs","ポーランド":"pl","スウェーデン":"se","エクアドル":"ec","ペルー":"pe","ジャマイカ":"jm","アルジェリア":"dz","ウクライナ":"ua","カメルーン":"cm","ガーナ":"gh","コートジボワール":"ci","ノルウェー":"no","トルコ":"tr","スコットランド":"gb-sct","ハンガリー":"hu","パラグアイ":"py","ベネズエラ":"ve","パナマ":"pa","ホンジュラス":"hn","ニュージーランド":"nz","南アフリカ":"za","ヨルダン":"jo","カタール":"qa","ウズベキスタン":"uz","オーストリア":"at","大陸間PO1":"un","大陸間PO2":"un","欧州PO1":"eu","欧州PO2":"eu","欧州PO3":"eu","欧州PO4":"eu","キュラソー":"cw","ハイチ":"ht","カボベルデ":"cv"};
	  
    // ページ読み込み時にポット分け表を表示
    // スマホ対応：ポット表を縦に並べる
    // 完全レスポンシブ対応ポット表
    window.onload = function() {
      const table = document.getElementById("potTable");
      table.innerHTML = "";
      [1,2,3,4].forEach(potNum => {
        const div = document.createElement("div");
        div.className = "pot";
        div.innerHTML = `<h2>ポット ${potNum}</h2>`;
        teams.filter(t => t.pot === potNum).forEach(t => {
          const teamDiv = document.createElement("div");
          teamDiv.className = `pot-team${t.name === "日本" ? " japan" : ""}`;
          teamDiv.innerHTML = `<img src="${getFlagUrl(t.name, 84,63)}" alt="${t.name}">${t.name}`;
          div.appendChild(teamDiv);
        });
        table.appendChild(div);
      });
    };
	  
    // 国旗URL生成
    function getFlagUrl(name,w=120,h=90) {
      const map =flagMap;
      return `https://flagcdn.com/${w}x${h}/${map[name] || "un"}.png`;
    }

    // 最新1件をド派手に表示（上書き）
    function announceDraw(team, groupLetter) {
      const el = document.getElementById("currentDraw");
      // 日本が決まった瞬間！
      if (team.name === "日本") {
        document.body.classList.add("japan-mode");
        document.getElementById("japanSpecial").style.display = "block";
        document.getElementById("japanLog").innerHTML = `
		絶対に負けられない戦いがある！│
		 <img src="https://flagcdn.com/16x12/jp.png" style="width:16px;height:12px;">
		 <a href="#group-${groupLetter}">日本→ グループ ${groupLetter}</a>│がんばれ日本！
		`;

        el.innerHTML = `
          <img src="https://flagcdn.com/256x192/jp.png" style="width:180px;height:120px;"><br>
          <span style="font-size:1rem;color:#bc002d;text-shadow:0 0 60px #fff;">日本</span><br>
          <span class="group-letter" style="font-size:1rem;color:#fff;">→ グループ ${groupLetter}</span>
        `;

        setTimeout(() => {
          document.body.classList.remove("japan-mode");
          document.getElementById("japanSpecial").style.display = "none";
        }, 3000);

      } else {
       el.innerHTML = `
        <img src="${getFlagUrl(team.name,120,90)}" alt="${team.name}"><br>
        <span>${team.name}</span><br>
        <span class="group-letter">→ グループ ${groupLetter}</span>
      `;
      }
      el.classList.remove("show");
      setTimeout(() => el.classList.add("show"), 50);
    }

    function showLoading(show = true) {
      document.getElementById("loadingContainer").classList.toggle("show", show);
    }

    function showTitle(show = true) {
      document.getElementById("pTitle").classList.toggle("show", show);
    }

    function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; }

    function canPlaceInGroup(team, groupTeams) {
      if (groupTeams.some(t => t.pot === team.pot)) return false;
      const confCount = groupTeams.reduce((c, t) => (c[t.conf] = (c[t.conf] || 0) + 1, c), {});
      return team.conf === "UEFA" ? (confCount.UEFA || 0) < 2 : (confCount[team.conf] || 0) === 0;
    }

    function addTeam(letter, team) {
      const div = document.createElement("div");
      div.className = "team";
      div.innerHTML = `
	  <img src="${getFlagUrl(team.name,16,12)}" alt="${team.name}">
	  ${team.pos}. ${team.name} <small>(${team.conf})</small> <span class="pot-label">Pot ${team.pot}</span>`;
      if (team.fixed) div.classList.add("host");
      document.querySelector(`#group-${letter}`).appendChild(div);
      setTimeout(() => div.classList.add("show"), 100);
    }

    function initGroups() {
      document.getElementById("result").innerHTML = "";
      document.getElementById("currentDraw").innerHTML = "";
      GROUPS.forEach(g => {
        const div = document.createElement("div");
        div.className = "group"; div.id = `group-${g}`;
        div.innerHTML = `<h2>グループ ${g}</h2>`;
        document.getElementById("result").appendChild(div);
      });
    }

    async function startDraw() {
      const btn = document.getElementById("startBtn");
      document.getElementById("japanLog").textContent = "";
	  // ポットテーブル
	  document.getElementById("potTable").textContent = "";
		
      // スムーズなアニメーションでスクロールする場合
      btn.scrollIntoView({
        behavior: 'smooth', // スムーズスクロール
        block: 'start'      // 要素の上端がビューポートの上端に揃うようにスクロール
      });
      btn.disabled = true; btn.textContent = "抽選中…";
 
	  // ← ここで固定ボタンを即非表示！
	  document.getElementById("shareButtons").classList.add("show");
	  document.getElementById("fixedButtons").classList.remove("show");
		
      showLoading(false);
      // showTitle(false);
      document.getElementById("statusText").textContent = "開催国を配置中…";
      initGroups();

      const groups = Object.fromEntries(GROUPS.map(g => [g, []]));
      const pots = {1: [], 2: [], 3: [], 4: []};
      teams.forEach(t => pots[t.pot].push({...t}));

      // 開催国
      teams.filter(t => t.fixed).forEach(h => {
        h.pos = 1; groups[h.fixed] = [h]; addTeam(h.fixed, h); announceDraw(h, h.fixed);
      });
      await new Promise(r => setTimeout(r, 2500));

      document.getElementById("statusText").textContent = "ポット1を配置中…";
showLoading(true);
      
      // ポット1残り
      const pot1rest = shuffle(pots[1].filter(t => !t.fixed));
      let empty = GROUPS.filter(g => groups[g].length === 0);
      pot1rest.forEach((t, i) => {
        const g = empty[i];
        t.pos = 1; groups[g].push(t); addTeam(g, t); announceDraw(t, g);
      });
      await new Promise(r => setTimeout(r, 3000));

showLoading(false);  document.getElementById("statusText").innerHTML = `<span style="color:#ffcb05;font-size:3.5rem;">ポット1 完了！</span>`;
await new Promise(r => setTimeout(r, 1000));
      
      // ポット2〜4
      for (let p = 2; p <= 4; p++) {
        showLoading(true);
        document.getElementById("statusText").textContent = "";
        await new Promise(r => setTimeout(r, 1000));

        document.getElementById("statusText").textContent = `ポット${p}を抽選中…`;
        
        const potTeams = shuffle(pots[p]);
        for (const team of potTeams) {
          let avail = GROUPS.filter(g => groups[g].length < 4 && canPlaceInGroup(team, groups[g]));
          if (avail.length === 0) avail = GROUPS.filter(g => groups[g].length < 4); // 最終手段
          const chosen = avail[Math.floor(Math.random() * avail.length)];
          team.pos = groups[chosen].length + 1;
          groups[chosen].push(team);
          addTeam(chosen, team);
          announceDraw(team, chosen);
          await new Promise(r => setTimeout(r, 900));
        }
        showLoading(false);
        document.getElementById("statusText").innerHTML = `<span style="color:#ffcb05;font-size:3.5rem;">ポット${p} 完了！</span>`;
        await new Promise(r => setTimeout(r, 2500));
      }

      document.getElementById("statusText").innerHTML = 
        `<div style="font-size:4.5rem;color:#ffcb05;text-shadow:0 0 50px gold;">抽選終了！</div>`;
      btn.textContent = "もう一度抽選";
      btn.disabled = false;

      // ← ここでシェアボタンを表示！
      document.getElementById("shareButtons").classList.add("show");
      document.getElementById("fixedButtons").classList.add("show");
      
		
      const res = document.getElementById("result");
      // スムーズなアニメーションでスクロールする場合
      res.scrollIntoView({
        behavior: 'smooth', // スムーズスクロール
        block: 'start'      // 要素の上端がビューポートの上端に揃うようにスクロール
      });
    }

    async function topScroll() {
      const pt = document.getElementById("pTitle");
      // スムーズなアニメーションでスクロールする場合
      pt.scrollIntoView({
        behavior: 'smooth', // スムーズスクロール
        block: 'start'      // 要素の上端がビューポートの上端に揃うようにスクロール
      });
    }

	// スクリーンショットボタン
  // スクリーンショット保存（ファイル名に現在時刻を付与）
// スクリーンショット保存（タブレット白問題＋スマホ反応しない問題を完全解決！）
document.querySelector(".share-btn.screenshot").onclick = async () => {
  try {
    // 結果エリアをキャプチャ（背景を強制指定）
    const element = document.getElementById("result");
    
    // 一時的に背景を強制適用（白くなるのを防ぐ）
    const originalBg = document.body.style.background;
    document.body.style.background = "linear-gradient(135deg, #0f2b5e, #1a4d8c)";

    const canvas = await html2canvas(element, {
      scale: window.devicePixelRatio || 2,
      useCORS: true,
      allowTaint: true,
      backgroundColor: "#0f2b5e",  // ← これが白くなるのを防ぐ最重要ポイント！
      logging: false,
      width: element.scrollWidth,
      height: element.scrollHeight,
      windowWidth: window.innerWidth,
      windowHeight: window.innerHeight
    });

    // 背景をもとに戻す
    document.body.style.background = originalBg;

    // 現在時刻でファイル名生成（ミリ秒まで）
    const now = new Date();
    const timestamp = now.getFullYear() +
      String(now.getMonth() + 1).padStart(2, '0') +
      String(now.getDate()).padStart(2, '0') +
      String(now.getHours()).padStart(2, '0') +
      String(now.getMinutes()).padStart(2, '0') +
      String(now.getSeconds()).padStart(2, '0') +
      String(now.getMilliseconds()).padStart(3, '0');
    
    const filename = `2026worldcup_${timestamp}.png`;

    // Blobで確実にダウンロード（スマホでも100%反応！）
    canvas.toBlob((blob) => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      // カッコいいトースト通知（alertより美しく、スマホでも反応する）
      const toast = document.createElement("div");
      toast.textContent = `保存しました！ ${filename}`;
      toast.style.cssText = `
        position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
        background: #ffcb05; color: #0f2b5e; padding: 16px 32px; border-radius: 50px;
        font-size: 1.4rem; font-weight: bold; z-index: 9999; box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        animation: toast 3s ease-out forwards;
      `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }, "image/png");

  } catch (err) {
    console.error(err);
    alert("スクリーンショットに失敗しました…");
  }
};



// X（Twitter）にシェアボタン
// X（Twitter）に画像付き＋メンション付きでシェア！
// Xシェアもスクショも「必ず横並びで見やすい」ように強制！
async function captureResultForShare() {
  const resultArea = document.getElementById("result");

  // 元のスタイル保存
  const originalStyle = resultArea.style.cssText;

  // 強制：横4列＋見やすい＋折り返し防止
  resultArea.style.cssText = `
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 25px !important;
    padding: 40px 30px !important;
    max-width: 1600px !important;
    margin: 0 auto !important;
    background: rgba(255,255,255,0.08) !important;
    border-radius: 30px !important;
  `;

  // 各グループを整える
  document.querySelectorAll(".group").forEach(g => {
    g.style.cssText += `
      padding: 28px !important;
      border-radius: 25px !important;
      min-width: 280px !important;
      background: rgba(255,255,255,0.15) !important;
    `;
  });

  // チーム名が折り返さないように超重要設定！
  document.querySelectorAll(".team").forEach(t => {
    t.style.cssText += `
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
      font-size: 1.15rem !important;
      padding: 12px 16px !important;
      margin: 8px 0 !important;
    `;
  });

  // グループタイトルも美しく
  document.querySelectorAll(".group h2").forEach(h => {
    h.style.fontSize = "2.6rem";
    h.style.marginBottom = "20px";
  });

  // レイアウト完全反映待ち
  await new Promise(r => setTimeout(r, 200));

  const canvas = await html2canvas(resultArea, {
    scale: window.devicePixelRatio || 2,
    useCORS: true,
    backgroundColor: "#0f2b5e",
    logging: false,
    width: resultArea.scrollWidth + 80,
    height: resultArea.scrollHeight + 140,
    windowWidth: document.body.scrollWidth
  });

  // 元に戻す（画面表示はユーザーの好み通り）
  resultArea.style.cssText = originalStyle;
  document.querySelectorAll(".group, .team, .group h2").forEach(el => {
    el.style.cssText = el.style.cssText.replace(/!important/g, '').replace(/;$/g, '');
  });

  return canvas;
}

// スクリーンショット保存（横4列・折り返しなし）
document.querySelector(".share-btn.xshare").onclick = async () => {
  try {
    const canvas = await captureResultForShare();  // 前回の横4列・折り返しなし関数

    // html2canvasのBlobをfetch経由で再変換（互換性向上）
    const dataUrl = canvas.toDataURL("image/png");
    const response = await fetch(dataUrl);
    const blob = await response.blob();

    // ★超強化Fileオブジェクト（2025年Android Chrome対応）★
    const file = new File(
      [blob],
      "2026worldcup_draw.png",
      {
        type: "image/png",
        lastModified: Date.now(),  // 必須：タイムスタンプを明示
      }
    );

    const tweetText = `@MILKSATOKYO @PureGreenX\n2026ワールドカップ抽選結果！\n日本はどのグループに入った？！\n#W杯2026 #日本代表`;

    // ★直接添付テスト（canShareで厳密チェック）★
    if (navigator.share && navigator.canShare({ files: [file] })) {
      const sharePromise = navigator.share({
        files: [file],
        title: "2026ワールドカップ抽選結果",
        text: tweetText
      });

      // 成功監視（AndroidでPromiseがresolveするまで待つ）
      sharePromise.then(() => {
        showToast("Xに直接投稿成功！");
      }).catch((err) => {
        console.error("Share failed:", err);
        fallbackToDownloadAndTweet(canvas, tweetText);
      });
    } else {
      // フォールバック：即ダウンロード＋Twitter Intent
      fallbackToDownloadAndTweet(canvas, tweetText);
    }

  } catch (err) {
    console.error("Share error:", err);
    fallbackToTweetOnly(tweetText);
  }
};

// フォールバック1：画像ダウンロード＋Twitter Intent
function fallbackToDownloadAndTweet(canvas, tweetText) {
  canvas.toBlob((blob) => {
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "2026worldcup_draw.png";
    a.click();
    URL.revokeObjectURL(url);
  });
  const enc = encodeURIComponent(tweetText);
  window.open(`https://twitter.com/intent/tweet?text=${enc}`, "_blank");
  showToast("画像をダウンロードしました！Xで添付して投稿♪");
}

// フォールバック2：画像なしTwitter投稿
function fallbackToTweetOnly(tweetText) {
  const enc = encodeURIComponent(tweetText.replace(/\n/g, ' '));  // 改行をスペースに（Intent互換）
  window.open(`https://twitter.com/intent/tweet?text=${enc}`, "_blank");
  showToast("X投稿画面を開きました！");
}

// トースト通知
function showToast(message) {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.style.cssText = `
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    background: #ffcb05; color: #0f2b5e; padding: 16px 36px; border-radius: 50px;
    font-size: 1.4rem; font-weight: bold; z-index: 9999; box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    animation: toast 3.5s ease-out forwards;
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3500);
}

// トーストアニメ
const style = document.createElement("style");
style.textContent = `@keyframes toast {0% { opacity: 0; transform: translateX(-50%) translateY(20px); }15% { opacity: 1; transform: translateX(-50%) translateY(0); }85% { opacity: 1; transform: translateX(-50%) translateY(0); }100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }}`;
document.head.appendChild(style);
	  
    document.getElementById("startBtn").onclick = startDraw;
	document.getElementById("startBtn2").onclick = startDraw;
    document.getElementById("scrollToTopBtn").onclick = topScroll;
	document.querySelector("#fixedButtons .screenshot").onclick = () => {
     document.querySelector(".share-btn.screenshot").click();
    };
   document.querySelector("#fixedButtons .xshare").onclick = () => {
    document.querySelector(".share-btn.xshare").click();
   };
  </script>
	
<div id="fixedButtons">
  <button class="fixed-btn screenshot">
    スクショ
  </button>
  <button class="fixed-btn xshare">
    シェア
  </button>
</div>
	
  <div id="bTitle">
   <a href="#pTitle">トップに戻る</a>
   <br>
   <hr>©PureGreen │ テストv0.06.26
  </div>
</body>
</html>
